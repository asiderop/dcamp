#!/usr/bin/env bash

# alias runall='./bin/run-basic -x base-r; ./bin/run-basic -x base-c; ./bin/run-basic start; sleep 5; ./bin/run-basic -x base-m'

BASEDIR=`dirname $0`/..
DCAMP=$BASEDIR/bin/dcamp
XTERM='xterm -r'

ROOT=localhost:55500
COLLECTOR=localhost:55700
METRIC=localhost:55730

USAGE="usage: `basename $0` [-x] <base-r|base-c|base-m|start|stop>"

if [ $# -lt 1 ]; then
	echo $USAGE
	exit 65
fi

X=1
if [ "$1" == "-x" ]; then
	X=0
	shift
fi

case "$1" in

	base-r)
		MODS="-d"
		MODS="--debug-module dcamp.service.Configuration"
		MODS="--debug-module dcamp.service.Management --debug-module dcamp.service.Node --debug-module dcamp.role.Root"
		if [ $X -eq 0 ]; then
			$XTERM -geometry 131x50+0+0 -T root -e $DCAMP $MODS base -a $ROOT &
		else
			$DCAMP $MODS base -a $ROOT
		fi
		;;

	base-c)
		MODS="--debug-module dcamp.service.Configuration"
		MODS="-d"
		if [ $X -eq 0 ]; then
			$XTERM -geometry 131x50+0+350 -T collector -e $DCAMP $MODS base -a $COLLECTOR &
		else
			$DCAMP $MODS base -a $COLLECTOR
		fi
		;;

	base-m)
		MODS="-d"
		MODS="--debug-module dcamp.service.Node --debug-module dcamp.service.Configuration"
		MODS="--debug-module dcamp.service.Node"
		if [ $X -eq 0 ]; then
			$XTERM -geometry 147x76-0+0 -T metric -e $DCAMP $MODS base -a $METRIC &
		else
			$DCAMP $MODS base -a $METRIC
		fi
		;;

	start)
		$DCAMP -d root -f $BASEDIR/dcamp.cfg --start -a $ROOT
		;;

	stop)
		$DCAMP -d root -f $BASEDIR/dcamp.cfg --stop -a $ROOT
		;;
	
	*)
		echo $USAGE
		exit 65
		;;

esac
